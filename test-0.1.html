<!doctype html>
<html lang="ja">
<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jasmine/3.3.0/jasmine.min.css">
</head>
<body>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jasmine/3.3.0/jasmine.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jasmine/3.3.0/jasmine-html.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jasmine/3.3.0/boot.min.js"></script>
<script src="https://bundle.run/buffer@6.0.3"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tweetnacl/1.0.2/nacl-fast.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha3/0.8.0/sha3.min.js"></script>

<script src="./tsunagi-sdk-0.1.js"></script>
<script>


jasmine.DEFAULT_TIMEOUT_INTERVAL =240000;
describe('tsunagi-sdk.0.1',() => {

	beforeEach(async()=>{
	});

	afterEach(async()=>{
	});

	beforeAll(async()=>{

		this.getPayload = async function(tx1){
		
			let catjson = await loadCatjson(tx1,this.network);
			let layout = await loadLayout(tx1,catjson,false); //isEmbedded false

			let preparedTx = await prepareTransaction(tx1,layout,this.network); //TX事前準備
			let parsedTx   = await parseTransaction(preparedTx,layout,catjson,this.network); //TX解析
			let builtTx    = buildTransaction(parsedTx); //TX構築

			let signature = signTransaction(builtTx,this.privateKey,this.network);
			builtTx = updateTransaction(builtTx,"signature","value",signature);

			//トランザクションハッシュ作成
			let txHash = hashTransaction(tx1.signer_public_key,signature,builtTx,this.network);

			let payload = hexlifyTransaction(builtTx);
			console.log(payload)
			console.log(txHash)

			return payload;
		}

		this.privateKey = "94ee0f4d7fe388ac4b04a6a6ae2ba969617879b83616e4d25710d688a89d80c7";
		this.bobPrivateKey = "fa6373f4f497773c5cc55c103e348b139461d61fd4b45387e69d08a68000e06b";
		this.carolPrivateKey = "1e090b2a266877a9f88a510af2eb0945a63dc69dbce674ccd83272717d4175cf";

		this.network = {
			version:1,
			network:'TESTNET',
			generationHash:'7fccd304802016bebbcd342a332f91ff1f3bb5e902988b352697be245f48e836',
			currencyMosaicId:0x3A8416DB2D53B6C8n,
			currencyNamespaceId:0xE74B99BA41F4AFEEn,
			currencyDivisibility:6,
			epochAdjustment:1637848847,
			catjasonBase:"https://xembook.github.io/tsunagi-sdk/catjson/",
			wellknownNodes:[
				'https://sym-test.opening-line.jp:3001',
				'https://sym-test.opening-line.jp:3001',
				'https://sym-test.opening-line.jp:3001',
			]
		}
		let deadlineFlag;
		if (1 < document.location.search.length) {

			const query = document.location.search.substring(1);
			const prms = query.split('&');
			const item = new Object();
			for (var i = 0; i < prms.length; i++) {
				const elm   = prms[i].split('=');
				const idx   = decodeURIComponent(elm[0]);
				const val   = decodeURIComponent(elm[1]);
				item[idx] = decodeURIComponent(val);
			}
			if("deadline" in item){
				deadlineFlag = item["deadline"];
			}
		}

		let now;
		if(deadlineFlag === "now"){
			now = Date.now();
		}else{
			now = this.network.epochAdjustment * 1000;
		}

//		let now = this.network.epochAdjustment * 1000;
//		let now = 0;
//		let now = Date.now(); //実際に使用できるpayloadを出力する場合（テストはエラーになります）
		let secs = 7200; //2時間後を期限とする場合
		let value = ((Math.trunc(now / 1000) + secs) - this.network.epochAdjustment) * 1000;
		this.deadline = BigInt(value);

		
	});

	describe('aggregate complete transaction', () => {

		it('resolves 3 account transfer', async () => {

			//Alice->Bob
			let tx1 = {
				type:'TRANSFER',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				recipient_address:"TCO7HLVDQUX6V7C737BCM3VYJ3MKP6REE2EKROA",
				mosaics:[
					{mosaic_id: 0x2A09B7F9097934C2n, amount: 1n},
					{mosaic_id: 0x3A8416DB2D53B6C8n, amount: 100n},
				],
				message:"Hello Tsunagi(Catjson) SDK!",
			}
			//Bob->Caroll
			let tx2 = {
				type:'TRANSFER',
				signer_public_key:"6199BAE3B241DF60418E258D046C22C8C1A5DE2F4F325753554E7FD9C650AFEC",
				recipient_address:"TDZBCWHAVA62R4JFZJJUXQWXLIRTUK5KZHFR5AQ",
				mosaics:[
					{mosaic_id: 0x3A8416DB2D53B6C8n, amount: 100n},
					{mosaic_id: 0x2A09B7F9097934C2n, amount: 1n},
				],
				message:"Hello Carol! This is Bob.",
			}
			//Caroll->Alice
			let tx3 = {
				type:'TRANSFER',
				signer_public_key:"886ADFBD4213576D63EA7E7A4BECE61C6933C27CD2FF36F85155C8FEBFB6EB4E",
				recipient_address:"TBUXMJAYYW3EH3XHBZXSBVGVKXKZS4EH26TINKI",
				mosaics:[
					{mosaic_id: 0x3A8416DB2D53B6C8n, amount: 100n},
					{mosaic_id: 0x2A09B7F9097934C2n, amount: 1n},
				],
				message:"Hello Alice, This is Carol.",
			}

			let cosignature1 = {
				version:0n,
				signer_public_key:"6199BAE3B241DF60418E258D046C22C8C1A5DE2F4F325753554E7FD9C650AFEC",
				signature:"",
			}

			let cosignature2 = {
				version:0n,
				signer_public_key:"886ADFBD4213576D63EA7E7A4BECE61C6933C27CD2FF36F85155C8FEBFB6EB4E",
				signature:"",
			}

			let aggTx = {
				type:'AGGREGATE_COMPLETE',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:1000000n,
				deadline:this.deadline,
				transactions:[tx1,tx2,tx3],
				cosignatures:[cosignature1,cosignature2]
			}

			let catjson = await loadCatjson(aggTx,this.network);
			let layout = await loadLayout(aggTx,catjson,false); //isEmbedded false

			let preparedTx = await prepareTransaction(aggTx,layout,this.network); //TX事前準備
			let parsedTx   = await parseTransaction(preparedTx,layout,catjson,this.network); //TX解析
			let builtTx    = buildTransaction(parsedTx); //TX構築

			let signature = signTransaction(builtTx,this.privateKey,this.network);
			builtTx = updateTransaction(builtTx,"signature","value",signature);

			//トランザクションハッシュ作成
			let txHash = hashTransaction(aggTx.signer_public_key,signature,builtTx,this.network);

			//連署
			cosignature1.signature = cosignTransaction(txHash,this.bobPrivateKey);
			cosignature2.signature = cosignTransaction(txHash,this.carolPrivateKey);

			let cosignaturesLayout = layout.find(lf=>lf.name === "cosignatures");
			let parsedCosignatures = await parseTransaction(preparedTx,[cosignaturesLayout],catjson,network); //構築
			builtTx = updateTransaction(builtTx,"cosignatures","layout",parsedCosignatures[0].layout);

			let payload = hexlifyTransaction(builtTx);
			console.log(payload)
			expect(payload)
			.toEqual(
				"28030000000000006f2651ea4046cbb9eca41fd2e38c4868915cae2ba4d77d00fc91eb5b3d0be60e243bb13248bb26b766ceecfc5f3452f6e25612160d476000694cfe39d867e60c5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb000000000198414140420f000000000000dd6d0000000000ae67220a53b24a241f2da951ba6cfe044aedc42a0afb5f2742c5a454e3c9c6e1b0010000000000008c000000000000005f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001985441989df3aea3852feafc5fdfc2266eb84ed8a7fa242688a8b81c00020000000000c2347909f9b7092a0100000000000000c8b6532ddb16843a64000000000000000048656c6c6f205473756e616769284361746a736f6e292053444b21000000008a000000000000006199bae3b241df60418e258d046c22c8c1a5de2f4f325753554e7fd9c650afec000000000198544198f21158e0a83da8f125ca534bc2d75a233a2baac9cb1e821a00020000000000c2347909f9b7092a0100000000000000c8b6532ddb16843a64000000000000000048656c6c6f204361726f6c21205468697320697320426f622e0000000000008c00000000000000886adfbd4213576d63ea7e7a4bece61c6933c27cd2ff36f85155c8febfb6eb4e00000000019854419869762418c5b643eee70e6f20d4d555d5997087d7a686a91c00020000000000c2347909f9b7092a0100000000000000c8b6532ddb16843a64000000000000000048656c6c6f20416c6963652c2054686973206973204361726f6c2e0000000000000000000000006199bae3b241df60418e258d046c22c8c1a5de2f4f325753554e7fd9c650afece4b39b5be018de8141b3b0df3ceb358a197ff70b8be8da99fc9246dd979e6285e3547d01744df5a306150e51f49846bab0b2aecabb4d13ef1f3d49c08478a7080000000000000000886adfbd4213576d63ea7e7a4bece61c6933c27cd2ff36f85155c8febfb6eb4e4794f0617eae1f3f862c286c3e75494f0bb8009f8a8bccf8acb3ceb7719234f0282cdddab7bbc6adb8041788a8642729ec53ea8f6e107e8e2615ae592d44a60c"
			);

		});

		it('resolves opposite cosignature', async () => {

			//Alice->Bob
			let tx1 = {
				type:'TRANSFER',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				recipient_address:"TCO7HLVDQUX6V7C737BCM3VYJ3MKP6REE2EKROA",
				mosaics:[
					{mosaic_id: 0x2A09B7F9097934C2n, amount: 1n},
					{mosaic_id: 0x3A8416DB2D53B6C8n, amount: 100n},
				],
				message:"Hello Tsunagi(Catjson) SDK!",
			}
			//Bob->Caroll
			let tx2 = {
				type:'TRANSFER',
				signer_public_key:"6199BAE3B241DF60418E258D046C22C8C1A5DE2F4F325753554E7FD9C650AFEC",
				recipient_address:"TDZBCWHAVA62R4JFZJJUXQWXLIRTUK5KZHFR5AQ",
				mosaics:[
					{mosaic_id: 0x3A8416DB2D53B6C8n, amount: 100n},
					{mosaic_id: 0x2A09B7F9097934C2n, amount: 1n},
				],
				message:"Hello Carol! This is Bob.",
			}
			//Caroll->Alice
			let tx3 = {
				type:'TRANSFER',
				signer_public_key:"886ADFBD4213576D63EA7E7A4BECE61C6933C27CD2FF36F85155C8FEBFB6EB4E",
				recipient_address:"TBUXMJAYYW3EH3XHBZXSBVGVKXKZS4EH26TINKI",
				mosaics:[
					{mosaic_id: 0x3A8416DB2D53B6C8n, amount: 100n},
					{mosaic_id: 0x2A09B7F9097934C2n, amount: 1n},
				],
				message:"Hello Alice, This is Carol.",
			}

			let cosignature1 = {
				version:0n,
				signer_public_key:"6199BAE3B241DF60418E258D046C22C8C1A5DE2F4F325753554E7FD9C650AFEC",
				signature:"",
			}

			let cosignature2 = {
				version:0n,
				signer_public_key:"886ADFBD4213576D63EA7E7A4BECE61C6933C27CD2FF36F85155C8FEBFB6EB4E",
				signature:"",
			}

			let aggTx = {
				type:'AGGREGATE_COMPLETE',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:1000000n,
				deadline:this.deadline,
				transactions:[tx1,tx2,tx3],
				cosignatures:[cosignature2,cosignature1]
			}

			let catjson = await loadCatjson(aggTx,this.network);
			let layout = await loadLayout(aggTx,catjson,false); //isEmbedded false

			let preparedTx = await prepareTransaction(aggTx,layout,this.network); //TX事前準備
			let parsedTx   = await parseTransaction(preparedTx,layout,catjson,this.network); //TX解析
			let builtTx    = buildTransaction(parsedTx); //TX構築

			let signature = signTransaction(builtTx,this.privateKey,this.network);
			builtTx = updateTransaction(builtTx,"signature","value",signature);

			//トランザクションハッシュ作成
			let txHash = hashTransaction(aggTx.signer_public_key,signature,builtTx,this.network);

			//連署
			cosignature1.signature = cosignTransaction(txHash,this.bobPrivateKey);
			cosignature2.signature = cosignTransaction(txHash,this.carolPrivateKey);

			let cosignaturesLayout = layout.find(lf=>lf.name === "cosignatures");
			let parsedCosignatures = await parseTransaction(preparedTx,[cosignaturesLayout],catjson,network); //構築
			builtTx = updateTransaction(builtTx,"cosignatures","layout",parsedCosignatures[0].layout);

			let payload = hexlifyTransaction(builtTx);
			console.log(payload)
			expect(payload)
			.toEqual(
				"28030000000000006f2651ea4046cbb9eca41fd2e38c4868915cae2ba4d77d00fc91eb5b3d0be60e243bb13248bb26b766ceecfc5f3452f6e25612160d476000694cfe39d867e60c5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb000000000198414140420f000000000000dd6d0000000000ae67220a53b24a241f2da951ba6cfe044aedc42a0afb5f2742c5a454e3c9c6e1b0010000000000008c000000000000005f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001985441989df3aea3852feafc5fdfc2266eb84ed8a7fa242688a8b81c00020000000000c2347909f9b7092a0100000000000000c8b6532ddb16843a64000000000000000048656c6c6f205473756e616769284361746a736f6e292053444b21000000008a000000000000006199bae3b241df60418e258d046c22c8c1a5de2f4f325753554e7fd9c650afec000000000198544198f21158e0a83da8f125ca534bc2d75a233a2baac9cb1e821a00020000000000c2347909f9b7092a0100000000000000c8b6532ddb16843a64000000000000000048656c6c6f204361726f6c21205468697320697320426f622e0000000000008c00000000000000886adfbd4213576d63ea7e7a4bece61c6933c27cd2ff36f85155c8febfb6eb4e00000000019854419869762418c5b643eee70e6f20d4d555d5997087d7a686a91c00020000000000c2347909f9b7092a0100000000000000c8b6532ddb16843a64000000000000000048656c6c6f20416c6963652c2054686973206973204361726f6c2e000000000000000000000000886adfbd4213576d63ea7e7a4bece61c6933c27cd2ff36f85155c8febfb6eb4e4794f0617eae1f3f862c286c3e75494f0bb8009f8a8bccf8acb3ceb7719234f0282cdddab7bbc6adb8041788a8642729ec53ea8f6e107e8e2615ae592d44a60c00000000000000006199bae3b241df60418e258d046c22c8c1a5de2f4f325753554e7fd9c650afece4b39b5be018de8141b3b0df3ceb358a197ff70b8be8da99fc9246dd979e6285e3547d01744df5a306150e51f49846bab0b2aecabb4d13ef1f3d49c08478a708"
			);

		});
		

		it('resolves no cosignature', async () => {

			//Alice->Bob
			let tx1 = {
				type:'TRANSFER',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				recipient_address:"TCO7HLVDQUX6V7C737BCM3VYJ3MKP6REE2EKROA",
				mosaics:[
					{mosaic_id: 0x2A09B7F9097934C2n, amount: 1n},
					{mosaic_id: 0x3A8416DB2D53B6C8n, amount: 100n},
				],
				message:"Hello Tsunagi(Catjson) SDK!",
			}
			//Bob->Caroll
			let tx2 = {
				type:'TRANSFER',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				recipient_address:"TDZBCWHAVA62R4JFZJJUXQWXLIRTUK5KZHFR5AQ",
				mosaics:[
					{mosaic_id: 0x3A8416DB2D53B6C8n, amount: 100n},
					{mosaic_id: 0x2A09B7F9097934C2n, amount: 1n},
				],
				message:"Hello Carol! This is Alice.",
			}

			let aggTx = {
				type:'AGGREGATE_COMPLETE',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:1000000n,
				deadline:this.deadline,
				transactions:[tx1,tx2],
				cosignatures:[]

			}

			let catjson = await loadCatjson(aggTx,this.network);
			let layout = await loadLayout(aggTx,catjson,false); //isEmbedded false

			let preparedTx = await prepareTransaction(aggTx,layout,this.network); //TX事前準備
			let parsedTx   = await parseTransaction(preparedTx,layout,catjson,this.network); //TX解析
			let builtTx    = buildTransaction(parsedTx); //TX構築

			let signature = signTransaction(builtTx,this.privateKey,this.network);
			builtTx = updateTransaction(builtTx,"signature","value",signature);

			//トランザクションハッシュ作成
			let txHash = hashTransaction(aggTx.signer_public_key,signature,builtTx,this.network);

			let payload = hexlifyTransaction(builtTx);
			console.log(payload)
			console.log(txHash)
			expect(payload)
			.toEqual(
				"c80100000000000083de0648e05d23036b302e5249554f6fc164917021d4cf07f1d19dfefaea34bfb8679fde237115d5ac3885ef4d4d76c16d4a930429970edbc1fb32a967d0d5025f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb000000000198414140420f000000000000dd6d000000000000de2f57a150d1073330b9d3273c651b675ed9ce2f200cac1d29717dffe6fe3120010000000000008c000000000000005f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001985441989df3aea3852feafc5fdfc2266eb84ed8a7fa242688a8b81c00020000000000c2347909f9b7092a0100000000000000c8b6532ddb16843a64000000000000000048656c6c6f205473756e616769284361746a736f6e292053444b21000000008c000000000000005f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb000000000198544198f21158e0a83da8f125ca534bc2d75a233a2baac9cb1e821c00020000000000c2347909f9b7092a0100000000000000c8b6532ddb16843a64000000000000000048656c6c6f204361726f6c21205468697320697320416c6963652e00000000"
			);

		});

		it('resolves undefined cosignature', async () => {

			//Alice->Bob
			let tx1 = {
				type:'TRANSFER',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				recipient_address:"TCO7HLVDQUX6V7C737BCM3VYJ3MKP6REE2EKROA",
				mosaics:[
					{mosaic_id: 0x2A09B7F9097934C2n, amount: 1n},
					{mosaic_id: 0x3A8416DB2D53B6C8n, amount: 100n},
				],
				message:"Hello Tsunagi(Catjson) SDK!",
			}
			//Bob->Caroll
			let tx2 = {
				type:'TRANSFER',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				recipient_address:"TDZBCWHAVA62R4JFZJJUXQWXLIRTUK5KZHFR5AQ",
				mosaics:[
					{mosaic_id: 0x3A8416DB2D53B6C8n, amount: 100n},
					{mosaic_id: 0x2A09B7F9097934C2n, amount: 1n},
				],
				message:"Hello Carol! This is Alice.",
			}

			let aggTx = {
				type:'AGGREGATE_COMPLETE',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:1000000n,
				deadline:this.deadline,
				transactions:[tx1,tx2],
			}

			let catjson = await loadCatjson(aggTx,this.network);
			let layout = await loadLayout(aggTx,catjson,false); //isEmbedded false

			let preparedTx = await prepareTransaction(aggTx,layout,this.network); //TX事前準備
			let parsedTx   = await parseTransaction(preparedTx,layout,catjson,this.network); //TX解析
			let builtTx    = buildTransaction(parsedTx); //TX構築

			let signature = signTransaction(builtTx,this.privateKey,this.network);
			builtTx = updateTransaction(builtTx,"signature","value",signature);

			//トランザクションハッシュ作成
			let txHash = hashTransaction(aggTx.signer_public_key,signature,builtTx,this.network);

			let payload = hexlifyTransaction(builtTx);
			console.log(payload)
			expect(payload)
			.toEqual(
				"c80100000000000083de0648e05d23036b302e5249554f6fc164917021d4cf07f1d19dfefaea34bfb8679fde237115d5ac3885ef4d4d76c16d4a930429970edbc1fb32a967d0d5025f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb000000000198414140420f000000000000dd6d000000000000de2f57a150d1073330b9d3273c651b675ed9ce2f200cac1d29717dffe6fe3120010000000000008c000000000000005f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001985441989df3aea3852feafc5fdfc2266eb84ed8a7fa242688a8b81c00020000000000c2347909f9b7092a0100000000000000c8b6532ddb16843a64000000000000000048656c6c6f205473756e616769284361746a736f6e292053444b21000000008c000000000000005f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb000000000198544198f21158e0a83da8f125ca534bc2d75a233a2baac9cb1e821c00020000000000c2347909f9b7092a0100000000000000c8b6532ddb16843a64000000000000000048656c6c6f204361726f6c21205468697320697320416c6963652e00000000"
			);
		});

	}); // aggregate complete transaction


	describe('aggregate bonded transaction', () => {

		it('resolves 3 account transfer', async () => {

			//Alice->Bob
			let tx1 = {
				type:'TRANSFER',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				recipient_address:"TCO7HLVDQUX6V7C737BCM3VYJ3MKP6REE2EKROA",
				mosaics:[
					{mosaic_id: 0x2A09B7F9097934C2n, amount: 1n},
					{mosaic_id: 0x3A8416DB2D53B6C8n, amount: 100n},
				],
				message:"Hello Tsunagi(Catjson) SDK!",
			}
			//Bob->Caroll
			let tx2 = {
				type:'TRANSFER',
				signer_public_key:"6199BAE3B241DF60418E258D046C22C8C1A5DE2F4F325753554E7FD9C650AFEC",
				recipient_address:"TDZBCWHAVA62R4JFZJJUXQWXLIRTUK5KZHFR5AQ",
				mosaics:[
					{mosaic_id: 0x3A8416DB2D53B6C8n, amount: 100n},
					{mosaic_id: 0x2A09B7F9097934C2n, amount: 1n},
				],
				message:"Hello Carol! This is Bob.",
			}
			//Caroll->Alice
			let tx3 = {
				type:'TRANSFER',
				signer_public_key:"886ADFBD4213576D63EA7E7A4BECE61C6933C27CD2FF36F85155C8FEBFB6EB4E",
				recipient_address:"TBUXMJAYYW3EH3XHBZXSBVGVKXKZS4EH26TINKI",
				mosaics:[
					{mosaic_id: 0x3A8416DB2D53B6C8n, amount: 100n},
					{mosaic_id: 0x2A09B7F9097934C2n, amount: 1n},
				],
				message:"Hello Alice, This is Carol.",
			}


			let aggTx = {
				type:'AGGREGATE_BONDED',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:1000000n,
				deadline:this.deadline,
				transactions:[tx1,tx2,tx3],
			}

			let catjson = await loadCatjson(aggTx,this.network);
			let layout = await loadLayout(aggTx,catjson,false); //isEmbedded false

			let preparedTx = await prepareTransaction(aggTx,layout,this.network); //TX事前準備
			let parsedTx   = await parseTransaction(preparedTx,layout,catjson,this.network); //TX解析
			let builtTx    = buildTransaction(parsedTx); //TX構築

			let signature = signTransaction(builtTx,this.privateKey,this.network);
			builtTx = updateTransaction(builtTx,"signature","value",signature);

			//トランザクションハッシュ作成
			let txHash = hashTransaction(aggTx.signer_public_key,signature,builtTx,this.network);

			let payload = hexlifyTransaction(builtTx);
			console.log(payload);
			console.log(txHash);
			expect(payload)
			.toEqual(
				"5802000000000000ffd1ebcc029c4997d904586292aa1aab8c87e992cd736c074d639419aeae7adc82ce4782f1276f2504b0c4548777dd48616754205c7741af5b2a248f89b4c4035f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb000000000198414240420f000000000000dd6d0000000000ae67220a53b24a241f2da951ba6cfe044aedc42a0afb5f2742c5a454e3c9c6e1b0010000000000008c000000000000005f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001985441989df3aea3852feafc5fdfc2266eb84ed8a7fa242688a8b81c00020000000000c2347909f9b7092a0100000000000000c8b6532ddb16843a64000000000000000048656c6c6f205473756e616769284361746a736f6e292053444b21000000008a000000000000006199bae3b241df60418e258d046c22c8c1a5de2f4f325753554e7fd9c650afec000000000198544198f21158e0a83da8f125ca534bc2d75a233a2baac9cb1e821a00020000000000c2347909f9b7092a0100000000000000c8b6532ddb16843a64000000000000000048656c6c6f204361726f6c21205468697320697320426f622e0000000000008c00000000000000886adfbd4213576d63ea7e7a4bece61c6933c27cd2ff36f85155c8febfb6eb4e00000000019854419869762418c5b643eee70e6f20d4d555d5997087d7a686a91c00020000000000c2347909f9b7092a0100000000000000c8b6532ddb16843a64000000000000000048656c6c6f20416c6963652c2054686973206973204361726f6c2e00000000"
			);

		});

	}); // aggregate bonded transaction


	describe('transfer transaction', () => {

		it('resolves 2 mosaic transfer', async () => {

			//Alice->Bob
			let tx1 = {
				type:'TRANSFER',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:25000n,
				deadline:this.deadline,
				recipient_address:"TCO7HLVDQUX6V7C737BCM3VYJ3MKP6REE2EKROA",
				mosaics:[
					{mosaic_id: 0x2A09B7F9097934C2n, amount: 1n},
					{mosaic_id: 0x3A8416DB2D53B6C8n, amount: 100n},
				],
				message:"Hello Tsunagi(Catjson) SDK!",
			}

			expect(await this.getPayload(tx1))
			.toEqual(
				"dc000000000000001e1a289eef4550fe482ff5a073ba9b91bf38e8623e8767eb54eae5fd48dba354f662dce635ad299efb050cbf187c6b52674613d7e81bb58a4a662d2528d491005f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001985441a86100000000000000dd6d0000000000989df3aea3852feafc5fdfc2266eb84ed8a7fa242688a8b81c00020000000000c2347909f9b7092a0100000000000000c8b6532ddb16843a64000000000000000048656c6c6f205473756e616769284361746a736f6e292053444b21"
			);
		});

		it('resolves opposite mosaice order', async () => {

			//Alice->Bob
			let tx1 = {
				type:'TRANSFER',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:25000n,
				deadline:this.deadline,
				recipient_address:"TCO7HLVDQUX6V7C737BCM3VYJ3MKP6REE2EKROA",
				mosaics:[
					{mosaic_id: 0x3A8416DB2D53B6C8n, amount: 100n},
					{mosaic_id: 0x2A09B7F9097934C2n, amount: 1n},
				],
				message:"Hello Tsunagi(Catjson) SDK!",
			}

			expect(await this.getPayload(tx1))
			.toEqual(
				"dc000000000000001e1a289eef4550fe482ff5a073ba9b91bf38e8623e8767eb54eae5fd48dba354f662dce635ad299efb050cbf187c6b52674613d7e81bb58a4a662d2528d491005f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001985441a86100000000000000dd6d0000000000989df3aea3852feafc5fdfc2266eb84ed8a7fa242688a8b81c00020000000000c2347909f9b7092a0100000000000000c8b6532ddb16843a64000000000000000048656c6c6f205473756e616769284361746a736f6e292053444b21"
			);
		})

		it('resolves null message', async () => {

			//Alice->Bob
			let tx1 = {
				type:'TRANSFER',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:25000n,
				deadline:this.deadline,
				recipient_address:"TCO7HLVDQUX6V7C737BCM3VYJ3MKP6REE2EKROA",
				mosaics:[
					{mosaic_id: 0x3A8416DB2D53B6C8n, amount: 100n},
					{mosaic_id: 0x2A09B7F9097934C2n, amount: 1n},
				],
				message:"",
			}

			let catjson = await loadCatjson(tx1,this.network);
			let layout = await loadLayout(tx1,catjson,false); //isEmbedded false

			let preparedTx = await prepareTransaction(tx1,layout,this.network); //TX事前準備
			let parsedTx   = await parseTransaction(preparedTx,layout,catjson,this.network); //TX解析
			let builtTx    = buildTransaction(parsedTx); //TX構築

			let signature = signTransaction(builtTx,this.privateKey,this.network);
			builtTx = updateTransaction(builtTx,"signature","value",signature);

			//トランザクションハッシュ作成
			let txHash = hashTransaction(tx1.signer_public_key,signature,builtTx,this.network);

			let payload = hexlifyTransaction(builtTx);

			console.log(payload);
			console.log(txHash);

			expect(payload)
			.toEqual(
				"c100000000000000c086746240315084735ebee633ff541056c5ba0f17c4d924a4b59c9531aa72243eaa7b76e5e0a9e32a15fb475be49a2f1ff1e380c763bcb2ab3ef5d83125b40d5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001985441a86100000000000000dd6d0000000000989df3aea3852feafc5fdfc2266eb84ed8a7fa242688a8b80100020000000000c2347909f9b7092a0100000000000000c8b6532ddb16843a640000000000000000"
			);
		})


		it('resolves undefined message', async () => {

			//Alice->Bob
			let tx1 = {
				type:'TRANSFER',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:25000n,
				deadline:this.deadline,
				recipient_address:"TCO7HLVDQUX6V7C737BCM3VYJ3MKP6REE2EKROA",
				mosaics:[
					{mosaic_id: 0x3A8416DB2D53B6C8n, amount: 100n},
					{mosaic_id: 0x2A09B7F9097934C2n, amount: 1n},
				],
			}

			let catjson = await loadCatjson(tx1,this.network);
			let layout = await loadLayout(tx1,catjson,false); //isEmbedded false

			let preparedTx = await prepareTransaction(tx1,layout,this.network); //TX事前準備
			let parsedTx   = await parseTransaction(preparedTx,layout,catjson,this.network); //TX解析
			let builtTx    = buildTransaction(parsedTx); //TX構築

			let signature = signTransaction(builtTx,this.privateKey,this.network);
			builtTx = updateTransaction(builtTx,"signature","value",signature);

			//トランザクションハッシュ作成
			let txHash = hashTransaction(tx1.signer_public_key,signature,builtTx,this.network);

			let payload = hexlifyTransaction(builtTx);
			console.log(payload)
			expect(payload)
			.toEqual(
				"c000000000000000fee4646022be8647455bc876a8f7f303233d297a5755cd1eb41999ae6c8cca2f0225e2b93c4aa793c68657c230578dc3af26c3ef32acae96ea1ae10c438278055f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001985441a86100000000000000dd6d0000000000989df3aea3852feafc5fdfc2266eb84ed8a7fa242688a8b80000020000000000c2347909f9b7092a0100000000000000c8b6532ddb16843a6400000000000000"
			);
		})

		it('resolves null mosaic transfer', async () => {

			//Alice->Bob
			let tx1 = {
				type:'TRANSFER',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:25000n,
				deadline:this.deadline,
				recipient_address:"TCO7HLVDQUX6V7C737BCM3VYJ3MKP6REE2EKROA",
				mosaics:[],
				message:"Hello Tsunagi(Catjson) SDK!",
			}

			let catjson = await loadCatjson(tx1,this.network);
			let layout = await loadLayout(tx1,catjson,false); //isEmbedded false

			let preparedTx = await prepareTransaction(tx1,layout,this.network); //TX事前準備
			let parsedTx   = await parseTransaction(preparedTx,layout,catjson,this.network); //TX解析
			let builtTx    = buildTransaction(parsedTx); //TX構築

			let signature = signTransaction(builtTx,this.privateKey,this.network);
			builtTx = updateTransaction(builtTx,"signature","value",signature);

			//トランザクションハッシュ作成
			let txHash = hashTransaction(tx1.signer_public_key,signature,builtTx,this.network);

			let payload = hexlifyTransaction(builtTx);
			console.log(payload);
			console.log(txHash);

			expect(payload)
			.toEqual(
				"bc00000000000000cd5b93e94f053a07a5a132d7f59708b6818d88840c150d6f6dc38a2ca2408fff0e7e3ee39599d1242a0e4a5869dec8a2847b05fb698fa39db2bf1c3bf46ce2005f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001985441a86100000000000000dd6d0000000000989df3aea3852feafc5fdfc2266eb84ed8a7fa242688a8b81c000000000000000048656c6c6f205473756e616769284361746a736f6e292053444b21"
			);
		});


		it('resolves undefined message and null mosaic', async () => {

			//Alice->Bob
			let tx1 = {
				type:'TRANSFER',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:25000n,
				deadline:this.deadline,
				recipient_address:"TCO7HLVDQUX6V7C737BCM3VYJ3MKP6REE2EKROA",
				mosaics:[],
			}

			let catjson = await loadCatjson(tx1,this.network);
			let layout = await loadLayout(tx1,catjson,false); //isEmbedded false

			let preparedTx = await prepareTransaction(tx1,layout,this.network); //TX事前準備
			let parsedTx   = await parseTransaction(preparedTx,layout,catjson,this.network); //TX解析
			let builtTx    = buildTransaction(parsedTx); //TX構築

			let signature = signTransaction(builtTx,this.privateKey,this.network);
			builtTx = updateTransaction(builtTx,"signature","value",signature);

			//トランザクションハッシュ作成
			let txHash = hashTransaction(tx1.signer_public_key,signature,builtTx,this.network);

			let payload = hexlifyTransaction(builtTx);
			console.log(payload);
			console.log(txHash);

			expect(payload)
			.toEqual(
				"a0000000000000002c271a17d41832515a9ad0e995a524a4859a001436a990370c4b53eaa63677b4d69edde0831171a10defc157ea01f1d5528a562c423e38c725fc5b37af35ee055f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001985441a86100000000000000dd6d0000000000989df3aea3852feafc5fdfc2266eb84ed8a7fa242688a8b80000000000000000"
			);
		})

		it('resolves null message and null mosaic', async () => {

			//Alice->Bob
			let tx1 = {
				type:'TRANSFER',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:25000n,
				deadline:this.deadline,
				recipient_address:"TCO7HLVDQUX6V7C737BCM3VYJ3MKP6REE2EKROA",
				mosaics:[],
				message:""
			}

			let catjson = await loadCatjson(tx1,this.network);
			let layout = await loadLayout(tx1,catjson,false); //isEmbedded false

			let preparedTx = await prepareTransaction(tx1,layout,this.network); //TX事前準備
			let parsedTx   = await parseTransaction(preparedTx,layout,catjson,this.network); //TX解析
			let builtTx    = buildTransaction(parsedTx); //TX構築

			let signature = signTransaction(builtTx,this.privateKey,this.network);
			builtTx = updateTransaction(builtTx,"signature","value",signature);

			//トランザクションハッシュ作成
			let txHash = hashTransaction(tx1.signer_public_key,signature,builtTx,this.network);

			let payload = hexlifyTransaction(builtTx);
			console.log(payload);
			console.log(txHash);
			expect(payload)
			.toEqual(
				"a100000000000000786d46993afe584dd4e1fd2904d8eb0ea67e27ca3c7ef81fd208a6f27c1450807234093f9be03bbda0b02d96a69bd2766595ac4ab59fbc5119d247181b5596065f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001985441a86100000000000000dd6d0000000000989df3aea3852feafc5fdfc2266eb84ed8a7fa242688a8b8010000000000000000"
			);
		})


	});

	describe('mosaic transaction', () => {

		//Failure_Mosaic_Modification_Disallowed
		it('resolves mosaic definition', async () => {

			let tx1 = {
				type:'MOSAIC_DEFINITION',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:25000n,
				deadline:this.deadline,
				duration: 0n,
				id:0x4DAFFBE5505DE676n,
				nonce: 1700836761,
				flags: 'TRANSFERABLE RESTRICTABLE',
				divisibility: 2
			}

			expect(await this.getPayload(tx1))
			.toEqual(
				"96000000000000008400ea1dd86f206c946ae4aacfdd2d9997ceb406028e3d3e67e0b20a2a0dae696d9084f7f38f64c56450a3d6cd305722cb37d60b462358bbe23b5d8e155a3f0f5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001984d41a86100000000000000dd6d000000000076e65d50e5fbaf4d000000000000000099b560650602"
			);
		});

		it('resolves mosaic supply change', async () => {

			let tx1 = {
				type: 'MOSAIC_SUPPLY_CHANGE',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:25000n,
				deadline:this.deadline,
				mosaic_id:0x4DAFFBE5505DE676n,
				delta: 1000n * 100n, // assuming divisibility = 2
				action: 'INCREASE'
			}

			expect(await this.getPayload(tx1))
			.toEqual(
				"9100000000000000cbec54081f0a62d5c5f84748df4668670fad447b53b44062e58d5cab054a2c8bcd8ab13533231825eda6156d4c73ba98978eccb011b0107f9bc9a0f071888e035f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001984d42a86100000000000000dd6d000000000076e65d50e5fbaf4da08601000000000001"
			);
		});

		it('resolves aggregate mosaic definition and supply change', async () => {

			//buffer.Buffer.from(nonce.nonce).readUInt32LE();
			//buffer.Buffer.from(new Uint32Array([699275411]).buffer).toString("hex");
			//sym.MosaicId.createFromNonce(nonce, alice.address).toHex();

			let tx1 = {
				type:'MOSAIC_DEFINITION',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				duration: 0n,
				id:0x4DAFFBE5505DE676n,
				nonce: 1700836761,
				flags: 'TRANSFERABLE RESTRICTABLE',
				divisibility: 2
			}

			let tx2 = {
				type: 'MOSAIC_SUPPLY_CHANGE',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				mosaic_id:0x4DAFFBE5505DE676n,
				delta: 1000n * 100n, // assuming divisibility = 2
				action: 'INCREASE'

			}

			let aggTx = {
				type:'AGGREGATE_COMPLETE',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:1000000n,
				deadline:this.deadline,
				transactions:[tx1,tx2],
			}

			let catjson = await loadCatjson(aggTx,this.network);
			let layout = await loadLayout(aggTx,catjson,false); //isEmbedded false

			let preparedTx = await prepareTransaction(aggTx,layout,this.network); //TX事前準備
			let parsedTx   = await parseTransaction(preparedTx,layout,catjson,this.network); //TX解析
			let builtTx    = buildTransaction(parsedTx); //TX構築

			let signature = signTransaction(builtTx,this.privateKey,this.network);
			builtTx = updateTransaction(builtTx,"signature","value",signature);

			//トランザクションハッシュ作成
			let txHash = hashTransaction(aggTx.signer_public_key,signature,builtTx,this.network);

			let payload = hexlifyTransaction(builtTx);
			console.log(payload);
			console.log(txHash)

			expect(payload)
			.toEqual(
				"3801000000000000c4b2ea423fd6eaa69407fb261cdb09b3d039923ad15a120ad1f1da61bcfd69db9b71cddc0bff730b3cd1b421b35f8cbc87a4765a204412b5efc34e221d50b20a5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb000000000198414140420f000000000000dd6d0000000000fc4405540b555f4dde5dc4ce67daeaf207e5485d8da24d5cfd6bf71fa064c9a5900000000000000046000000000000005f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001984d4176e65d50e5fbaf4d000000000000000099b560650602000041000000000000005f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001984d4276e65d50e5fbaf4da0860100000000000100000000000000"
			);
		});



	});

	describe('namespace transaction', () => {

		it('resolves root namespace regisration', async () => {

			let tx1 = {
				type:'NAMESPACE_REGISTRATION',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:25000n,
				deadline:this.deadline,
				duration: 86400n,
				registration_type: "ROOT",
				name:"xembook",
				id:0xA43415EB268C7385n, //BigInt((new sym.NamespaceId("xembook")).id.toString())
			}

			expect(await this.getPayload(tx1))
			.toEqual(
				"99000000000000003983d675dd3affcab71fb09ee51cbddd4e8ee587335e030472dd50370333266ad571c4c94410262c7bb2ecc99b2b4b8eab71245046f41518d52ef6d5355792055f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001984e41a86100000000000000dd6d0000000000805101000000000085738c26eb1534a4000778656d626f6f6b"
			);
		});

		it('resolves sub namespace regisration', async () => {

			let tx1 = {
				type:'NAMESPACE_REGISTRATION',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:25000n,
				deadline:this.deadline,
				parent_id: 0xA43415EB268C7385n, //BigInt((new sym.NamespaceId("xembook")).id.toString())
				registration_type: "CHILD",
				name:"tomato",
				id:0xFA547FD28C836431n, //BigInt((new sym.NamespaceId("xembook.tomato")).id.toString())
			}

			expect(await this.getPayload(tx1))
			.toEqual(
				"9800000000000000942e0fe89a3471a075f2cbd06cc64d4d8af5cd8e58c437aa39fa05e47bb9230c9a259d9da70279c8656749792310585b138e19889b3b41e7e01c14a4cbea1b025f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001984e41a86100000000000000dd6d000000000085738c26eb1534a43164838cd27f54fa0106746f6d61746f"
			);
		});

		it('resolves address alias', async () => {

			let tx1 = {
				type:'ADDRESS_ALIAS',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:25000n,
				deadline:this.deadline,
				namespace_id:0xA43415EB268C7385n, //BigInt((new sym.NamespaceId("xembook")).id.toString()),
				address:"TBUXMJAYYW3EH3XHBZXSBVGVKXKZS4EH26TINKI",
				alias_action:"LINK"
			}

			expect(await this.getPayload(tx1))
			.toEqual(
				"a1000000000000008f61856b455c0a57db652844aa761281c019511d7b0cd0ae9b54e4b22585f36f012116860ce9f5300fe0e91521be74d8434032bf73e008b2f52d5f0744ef13045f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001984e42a86100000000000000dd6d000000000085738c26eb1534a49869762418c5b643eee70e6f20d4d555d5997087d7a686a901"
			);
		});

		it('resolves mosaic alias', async () => {

			let tx1 = {
				type:'MOSAIC_ALIAS',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:25000n,
				deadline:this.deadline,
				namespace_id:0xFA547FD28C836431n, //BigInt((new sym.NamespaceId("xembook.tomato")).id.toString()),
				mosaic_id:0x4DAFFBE5505DE676n,
				alias_action:"LINK"
			}

			expect(await this.getPayload(tx1))
			.toEqual(
				"910000000000000041f45e3bbbc8073c14b6e05b71fa9299692d1eafc86300b59698207ef044c7db8e346870c57df722497803549e2e3f8d5777c5e1c98fdf27a562d814076acc035f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb0000000001984e43a86100000000000000dd6d00000000003164838cd27f54fa76e65d50e5fbaf4d01"
			);
		});


	});
	
	describe('metadata transaction', () => {

		it('resolves account metadata', async () => {

			let tx1 = {
				type:'ACCOUNT_METADATA',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				target_address:"TBUXMJAYYW3EH3XHBZXSBVGVKXKZS4EH26TINKI",
				scoped_metadata_key:0x9772B71B058127D7n, //"key_account"
				value_size_delta:27,
				value:"Hello Tsunagi(Catjson) SDK!",
			}


			let aggTx = {
				type:'AGGREGATE_COMPLETE',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:1000000n,
				deadline:this.deadline,
				transactions:[tx1],
			}

			let catjson = await loadCatjson(aggTx,this.network);
			let layout = await loadLayout(aggTx,catjson,false); //isEmbedded false

			let preparedTx = await prepareTransaction(aggTx,layout,this.network); //TX事前準備
			let parsedTx   = await parseTransaction(preparedTx,layout,catjson,this.network); //TX解析
			let builtTx    = buildTransaction(parsedTx); //TX構築

			let signature = signTransaction(builtTx,this.privateKey,this.network);
			builtTx = updateTransaction(builtTx,"signature","value",signature);

			//トランザクションハッシュ作成
			let txHash = hashTransaction(aggTx.signer_public_key,signature,builtTx,this.network);

			let payload = hexlifyTransaction(builtTx);
			console.log(payload);
			console.log(txHash)

			expect(payload)
			.toEqual(
				"1801000000000000f6f159ba7929828c37c4c81987ffe73709c9cbf5c4139827236d780c0ce3d6cfae5d9d76619055ca31caeed995da7aafba3a2635da58af8820d6127fc1f96d025f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb000000000198414140420f000000000000dd6d0000000000765f150d97dd08f64258c5632403090fd6f36e7d4845b7d9c0a24c1c320e9b2b70000000000000006f000000000000005f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb00000000019844419869762418c5b643eee70e6f20d4d555d5997087d7a686a9d72781051bb772971b001b0048656c6c6f205473756e616769284361746a736f6e292053444b2100"
			);
		});

		it('resolves account metadata without aggregate', async () => {
			//ResourceNotFound

			let tx1 = {
				type:'ACCOUNT_METADATA',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:1000000n,
				deadline:this.deadline,
				target_address:"TBUXMJAYYW3EH3XHBZXSBVGVKXKZS4EH26TINKI",
				scoped_metadata_key:0x9772B71B058127D7n, //"key_account"
				value_size_delta:27,
				value:"Hello Tsunagi(Catjson) SDK!",
			}

			expect(await this.getPayload(tx1))
			.toEqual(
				"bf00000000000000eff25fc449d936edd1003af36b028a53dad3b5ee1a0f4502682a5a79159fac4712a528cebdf4351f28aa7b417b6906d08022135b9bbe55abeb2fb50831e555035f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb000000000198444140420f000000000000dd6d00000000009869762418c5b643eee70e6f20d4d555d5997087d7a686a9d72781051bb772971b001b0048656c6c6f205473756e616769284361746a736f6e292053444b21"
			);
		});


		it('resolves mosaic metadata', async () => {

			let tx1 = {
				type:'MOSAIC_METADATA',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:1000000n,
				deadline:this.deadline,
				target_address:"TBUXMJAYYW3EH3XHBZXSBVGVKXKZS4EH26TINKI",
				target_mosaic_id:0x4DAFFBE5505DE676n,
				scoped_metadata_key:0xCF217E116AA422E2n, //"key_mosaic"
				value_size_delta:27,
				value:"Hello Tsunagi(Catjson) SDK!",
			};

			let aggTx = {
				type:'AGGREGATE_COMPLETE',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:1000000n,
				deadline:this.deadline,
				transactions:[tx1],
			}

			let catjson = await loadCatjson(aggTx,this.network);
			let layout = await loadLayout(aggTx,catjson,false); //isEmbedded false

			let preparedTx = await prepareTransaction(aggTx,layout,this.network); //TX事前準備
			let parsedTx   = await parseTransaction(preparedTx,layout,catjson,this.network); //TX解析
			let builtTx    = buildTransaction(parsedTx); //TX構築

			let signature = signTransaction(builtTx,this.privateKey,this.network);
			builtTx = updateTransaction(builtTx,"signature","value",signature);

			//トランザクションハッシュ作成
			let txHash = hashTransaction(aggTx.signer_public_key,signature,builtTx,this.network);

			let payload = hexlifyTransaction(builtTx);
			console.log(payload);
			console.log(txHash)

			expect(payload)
			.toEqual(
				"2001000000000000b6c125c94aed659dc1346151d03e72552dfe57c6882baa924310f3cddea39c2387bf238aba046b6a7a2f849802b38bb5f046de6b455e60a2fbaa5f22eb4d53005f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb000000000198414140420f000000000000dd6d0000000000eadc97a286bf8081b523c4d246cf6ca05f208835b82e1f97ad978a2d638386a2780000000000000077000000000000005f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb00000000019844429869762418c5b643eee70e6f20d4d555d5997087d7a686a9e222a46a117e21cf76e65d50e5fbaf4d1b001b0048656c6c6f205473756e616769284361746a736f6e292053444b2100"
			);
		});


		it('resolves mosaic metadata without aggregate', async () => {
			//ResourceNotFound

			let tx1 = {
				type:'MOSAIC_METADATA',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:1000000n,
				deadline:this.deadline,
				target_address:"TBUXMJAYYW3EH3XHBZXSBVGVKXKZS4EH26TINKI",
				target_mosaic_id:0x4DAFFBE5505DE676n,
				scoped_metadata_key:0xCF217E116AA422E2n, //"key_mosaic"
				value_size_delta:27,
				value:"Hello Tsunagi(Catjson) SDK!",
			};

			expect(await this.getPayload(tx1))
			.toEqual(
				"c700000000000000dc5ff39f1dc61eb4500f2d19dec8bc36f03dffcb65504e906e6f6e6eecb71022b9e88993f4f55de53ba969563ad48be7fb718aaf1021617a1fa6324814f9b0045f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb000000000198444240420f000000000000dd6d00000000009869762418c5b643eee70e6f20d4d555d5997087d7a686a9e222a46a117e21cf76e65d50e5fbaf4d1b001b0048656c6c6f205473756e616769284361746a736f6e292053444b21"
			);
		});


		it('resolves namespace metadata', async () => {

			let tx1 = {
				type:'NAMESPACE_METADATA',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:1000000n,
				deadline:this.deadline,
				target_address:"TBUXMJAYYW3EH3XHBZXSBVGVKXKZS4EH26TINKI",
				target_namespace_id:0xA43415EB268C7385n, //xembook
				scoped_metadata_key:0x8B6A8A370873D0D9n, //"key_namespace"
				value_size_delta:27,
				value:"Hello Tsunagi(Catjson) SDK!",
			}

			let aggTx = {
				type:'AGGREGATE_COMPLETE',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:1000000n,
				deadline:this.deadline,
				transactions:[tx1],
			}

			let catjson = await loadCatjson(aggTx,this.network);
			let layout = await loadLayout(aggTx,catjson,false); //isEmbedded false

			let preparedTx = await prepareTransaction(aggTx,layout,this.network); //TX事前準備
			let parsedTx   = await parseTransaction(preparedTx,layout,catjson,this.network); //TX解析
			let builtTx    = buildTransaction(parsedTx); //TX構築

			let signature = signTransaction(builtTx,this.privateKey,this.network);
			builtTx = updateTransaction(builtTx,"signature","value",signature);

			//トランザクションハッシュ作成
			let txHash = hashTransaction(aggTx.signer_public_key,signature,builtTx,this.network);

			let payload = hexlifyTransaction(builtTx);
			console.log(payload);
			console.log(txHash)

			expect(payload)
			.toEqual(
				"2001000000000000b80a6851320a00db3e505516813106f3190fbbd349266667373faf85cdd370cec50c3224c8110c62147a3bffb7be8b1bc09aec7d7701bc15299b45c18ddd70015f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb000000000198414140420f000000000000dd6d0000000000accdb81d64d2626a79d546a2380171879f39beecc9b314805ca9b5a0d2b547e4780000000000000077000000000000005f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb00000000019844439869762418c5b643eee70e6f20d4d555d5997087d7a686a9d9d07308378a6a8b85738c26eb1534a41b001b0048656c6c6f205473756e616769284361746a736f6e292053444b2100"
			);
		});


		it('resolves namespace metadata without aggregate', async () => {
			//ResourceNotFound

			let tx1 = {
				type:'NAMESPACE_METADATA',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:1000000n,
				deadline:this.deadline,
				target_address:"TBUXMJAYYW3EH3XHBZXSBVGVKXKZS4EH26TINKI",
				target_namespace_id:0xA43415EB268C7385n, //xembook
				scoped_metadata_key:0x8B6A8A370873D0D9n, //"key_namespace"
				value_size_delta:27,
				value:"Hello Tsunagi(Catjson) SDK!",
			}

			expect(await this.getPayload(tx1))
			.toEqual(
				"c700000000000000093141b56044db8b665d8c86f3119988f505c8ac3ad557f22383b2d8b0e2177fd934059df8e7890632b0ec020a087bf0569f8a992201a9e9a69870aa14351e055f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb000000000198444340420f000000000000dd6d00000000009869762418c5b643eee70e6f20d4d555d5997087d7a686a9d9d07308378a6a8b85738c26eb1534a41b001b0048656c6c6f205473756e616769284361746a736f6e292053444b21"
			);
		});

	});

	describe('multisig transaction', () => {
	

		it('resolves multisig account modification address_additions', async () => {

			let tx1 = {
				type:'MULTISIG_ACCOUNT_MODIFICATION',
				signer_public_key:"66ADB706BC9A93E6E803B2B76A1341A8ACD98690EF204B402643AE3D4701EE77",
				min_removal_delta:1,
				min_approval_delta:1,
				address_additions:[
					"TCO7HLVDQUX6V7C737BCM3VYJ3MKP6REE2EKROA",
					"TBUXMJAYYW3EH3XHBZXSBVGVKXKZS4EH26TINKI"
				],
				address_deletions:[]
			}

			let cosignature1 = {
				version:0n,
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				signature:"",
			}

			let cosignature2 = {
				version:0n,
				signer_public_key:"6199BAE3B241DF60418E258D046C22C8C1A5DE2F4F325753554E7FD9C650AFEC",
				signature:"",
			}

			let aggTx = {
				type:'AGGREGATE_COMPLETE',
				signer_public_key:"66ADB706BC9A93E6E803B2B76A1341A8ACD98690EF204B402643AE3D4701EE77",
				fee:1000000n,
				deadline:this.deadline,
				transactions:[tx1],
				cosignatures:[cosignature1,cosignature2]
			}

			let catjson = await loadCatjson(aggTx,this.network);
			let layout = await loadLayout(aggTx,catjson,false); //isEmbedded false

			let preparedTx = await prepareTransaction(aggTx,layout,this.network); //TX事前準備
			let parsedTx   = await parseTransaction(preparedTx,layout,catjson,this.network); //TX解析
			let builtTx    = buildTransaction(parsedTx); //TX構築

			let signature = signTransaction(builtTx,"22F0BA129FE0C66BA596D7127B85961BF8EEF32784364338BACB4E88D6F284D6",this.network);
			builtTx = updateTransaction(builtTx,"signature","value",signature);

			//トランザクションハッシュ作成
			let txHash = hashTransaction(aggTx.signer_public_key,signature,builtTx,this.network);

			//連署
			cosignature1.signature = cosignTransaction(txHash,"94ee0f4d7fe388ac4b04a6a6ae2ba969617879b83616e4d25710d688a89d80c7");
			cosignature2.signature = cosignTransaction(txHash,"fa6373f4f497773c5cc55c103e348b139461d61fd4b45387e69d08a68000e06b");

			let cosignaturesLayout = layout.find(lf=>lf.name === "cosignatures");
			let parsedCosignatures = await parseTransaction(preparedTx,[cosignaturesLayout],catjson,network); //構築
			builtTx = updateTransaction(builtTx,"cosignatures","layout",parsedCosignatures[0].layout);

			let payload = hexlifyTransaction(builtTx);
			console.log(payload);
			console.log(txHash);
			expect(payload)
			.toEqual(
				"e001000000000000bf1f73806cedc96540806bd2535be327889448b282e23168ab543037774e202f8d89245c6d4af99f476cf547decd0ae1f77b809ce2e3ec33eb39f3bcaed7970d66adb706bc9a93e6e803b2b76a1341a8acd98690ef204b402643ae3d4701ee77000000000198414140420f000000000000dd6d0000000000336c1c549f927fd26a4ff9f3602423cb544e766d6c2c655e261c80679f185cb56800000000000000680000000000000066adb706bc9a93e6e803b2b76a1341a8acd98690ef204b402643ae3d4701ee7700000000019855410101020000000000989df3aea3852feafc5fdfc2266eb84ed8a7fa242688a8b89869762418c5b643eee70e6f20d4d555d5997087d7a686a900000000000000005f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cbfa0f1120bdd09578723c07734b3a6bebe9810b2871d24532f7bcaba613f821a1ae9835b5dc3927ff6f350f3ca5e3490067b76d23274e264ba30b58e0643fea0400000000000000006199bae3b241df60418e258d046c22c8c1a5de2f4f325753554e7fd9c650afec959793a935b0c02b860238732cff351bef70d82af806ce56223205ee6d89f76fedb8fb4b5ae0004bced6db5e5fc6283c3d8a78a1a54a4de197dc75bef0b1210a"
			);
		});

		it('resolves multisig account modification change delta', async () => {

			let tx1 = {
				type:'MULTISIG_ACCOUNT_MODIFICATION',
				signer_public_key:"66ADB706BC9A93E6E803B2B76A1341A8ACD98690EF204B402643AE3D4701EE77",
				min_removal_delta:1,
				min_approval_delta:1,
			}

			let aggTx = {
				type:'AGGREGATE_COMPLETE',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:1000000n,
				deadline:this.deadline,
				transactions:[tx1],
			}

			let catjson = await loadCatjson(aggTx,this.network);
			let layout = await loadLayout(aggTx,catjson,false); //isEmbedded false

			let preparedTx = await prepareTransaction(aggTx,layout,this.network); //TX事前準備
			let parsedTx   = await parseTransaction(preparedTx,layout,catjson,this.network); //TX解析
			let builtTx    = buildTransaction(parsedTx); //TX構築

			let signature = signTransaction(builtTx,"94ee0f4d7fe388ac4b04a6a6ae2ba969617879b83616e4d25710d688a89d80c7",this.network);
			builtTx = updateTransaction(builtTx,"signature","value",signature);

			//トランザクションハッシュ作成
			let txHash = hashTransaction(aggTx.signer_public_key,signature,builtTx,this.network);


			let payload = hexlifyTransaction(builtTx);
			console.log(payload);
			console.log(txHash);
			expect(payload)
			.toEqual(
				"e00000000000000000e3f627769675a51f98c7a9745e8540e74f33a2ed63932e7de26f87b98dc94af51b133ab7d6826e1de86c9cbaa160a7aec5da4d9972ce915da8bf0c85a3010f5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb000000000198414140420f000000000000dd6d0000000000be95dbbb0adf29fe5f5a766fbf3c10e4a60e0d71c216d263e2b167e06c70dac93800000000000000380000000000000066adb706bc9a93e6e803b2b76a1341a8acd98690ef204b402643ae3d4701ee7700000000019855410101000000000000"
			);
		});

		it('resolves multisig account modification address_deletions', async () => {

			let tx1 = {
				type:'MULTISIG_ACCOUNT_MODIFICATION',
				signer_public_key:"66ADB706BC9A93E6E803B2B76A1341A8ACD98690EF204B402643AE3D4701EE77",
				min_removal_delta:-1,
				min_approval_delta:-1,
				address_additions:[],
				address_deletions:[
					"TCO7HLVDQUX6V7C737BCM3VYJ3MKP6REE2EKROA"
				]
			}

			let cosignature2 = {
				version:0n,
				signer_public_key:"6199BAE3B241DF60418E258D046C22C8C1A5DE2F4F325753554E7FD9C650AFEC",
				signature:"",
			}


			let aggTx = {
				type:'AGGREGATE_COMPLETE',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:1000000n,
				deadline:this.deadline,
				transactions:[tx1],
				cosignatures:[cosignature2]
			}

			let catjson = await loadCatjson(aggTx,this.network);
			let layout = await loadLayout(aggTx,catjson,false); //isEmbedded false

			let preparedTx = await prepareTransaction(aggTx,layout,this.network); //TX事前準備
			let parsedTx   = await parseTransaction(preparedTx,layout,catjson,this.network); //TX解析
			let builtTx    = buildTransaction(parsedTx); //TX構築

			let signature = signTransaction(builtTx,"94ee0f4d7fe388ac4b04a6a6ae2ba969617879b83616e4d25710d688a89d80c7",this.network);
			builtTx = updateTransaction(builtTx,"signature","value",signature);

			//トランザクションハッシュ作成
			let txHash = hashTransaction(aggTx.signer_public_key,signature,builtTx,this.network);

			//連署
			cosignature2.signature = cosignTransaction(txHash,"fa6373f4f497773c5cc55c103e348b139461d61fd4b45387e69d08a68000e06b");
			let cosignaturesLayout = layout.find(lf=>lf.name === "cosignatures");
			let parsedCosignatures = await parseTransaction(preparedTx,[cosignaturesLayout],catjson,network); //構築
			builtTx = updateTransaction(builtTx,"cosignatures","layout",parsedCosignatures[0].layout);

			let payload = hexlifyTransaction(builtTx);
			console.log(payload);
			console.log(txHash);
			expect(payload)
			.toEqual(
				"6001000000000000a119633807603dffcfa86a981b4e31d97f6d21a024470139aeee0400ea748695943486743bf3fa3c6edf6207b47afbdfec3b086b8560e9ba3460f43a70391c0e5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb000000000198414140420f000000000000dd6d0000000000317c15bcbe4d9edadca95ed3fbeabe47fe41e749fbc120e9b83abf57083163745000000000000000500000000000000066adb706bc9a93e6e803b2b76a1341a8acd98690ef204b402643ae3d4701ee770000000001985541ffff000100000000989df3aea3852feafc5fdfc2266eb84ed8a7fa242688a8b800000000000000006199bae3b241df60418e258d046c22c8c1a5de2f4f325753554e7fd9c650afeccf75de4350bbfd1a8f4e7fb3c42e7c50725a9403ca5234fb71268c5eb6691734007a5fe0f8cc14a93011e76a6477e0e8ae1d7a0f9607e4deed709d1a3937c309"
			);
		});


		it('resolves multisig account modification address_deletions 2', async () => {

			let tx1 = {
				type:'MULTISIG_ACCOUNT_MODIFICATION',
				signer_public_key:"66ADB706BC9A93E6E803B2B76A1341A8ACD98690EF204B402643AE3D4701EE77",
				min_removal_delta:-1,
				min_approval_delta:-1,
				address_deletions:["TBUXMJAYYW3EH3XHBZXSBVGVKXKZS4EH26TINKI"]
			}

			let aggTx = {
				type:'AGGREGATE_COMPLETE',
				signer_public_key:"5f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb",
				fee:1000000n,
				deadline:this.deadline,
				transactions:[tx1],
			}

			let catjson = await loadCatjson(aggTx,this.network);
			let layout = await loadLayout(aggTx,catjson,false); //isEmbedded false

			let preparedTx = await prepareTransaction(aggTx,layout,this.network); //TX事前準備
			let parsedTx   = await parseTransaction(preparedTx,layout,catjson,this.network); //TX解析
			let builtTx    = buildTransaction(parsedTx); //TX構築

			let signature = signTransaction(builtTx,"94ee0f4d7fe388ac4b04a6a6ae2ba969617879b83616e4d25710d688a89d80c7",this.network);
			builtTx = updateTransaction(builtTx,"signature","value",signature);

			//トランザクションハッシュ作成
			let txHash = hashTransaction(aggTx.signer_public_key,signature,builtTx,this.network);


			let payload = hexlifyTransaction(builtTx);
			console.log(payload);
			console.log(txHash);
			expect(payload)
			.toEqual(
				"f800000000000000434d6772e7f92dc5daf56ec8310afce152203a8c3b1dc25d87d1fe1d2300f452d28801cb6e1e59f77ad4f73cac28cdd027e17a44040c7bbb8185462359f1ad005f594dfc018578662e0b5a2f5f83ecfb1cda2b32e29ff1d9b2c5e7325c4cf7cb000000000198414140420f000000000000dd6d0000000000bdbccdc54cb19c89113a1c58ecfa776ded496a0b55568d7338530208137922fb5000000000000000500000000000000066adb706bc9a93e6e803b2b76a1341a8acd98690ef204b402643ae3d4701ee770000000001985541ffff0001000000009869762418c5b643eee70e6f20d4d555d5997087d7a686a9"
			);
		});

	
	});
	describe('account restriction transaction', () => {});
	describe('global mosaic restriction transaction', () => {});
	describe('seclet lock transaction', () => {});

});//symbol-sdk
</script>

</body>
</html>
